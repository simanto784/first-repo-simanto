name: C CI/CD

on: [push, pull_request]

jobs:
  build_test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - run: sudo apt-get install build-essential -y
    - run: make
    - run: ./test
    - uses: actions/upload-artifact@v3
      with:
        name: main
        path: main

  deploy:
    runs-on: ubuntu-latest
    needs: build_test
    if: github.ref == 'refs/heads/main'
    steps:
    - uses: actions/checkout@v3
    - uses: actions/download-artifact@v3
      with:
        name: main
        path: deploy

    # --- Optional Deployment ---
    # - uses: appleboy/scp-action@v0.1.5
    #   with:
    #     host: ${{ secrets.SERVER_IP }}
    #     username: ${{ secrets.SERVER_USER }}
    #     key: ${{ secrets.SERVER_SSH_KEY }}
    #     source: "deploy/main"
    #     target: "~/apps/"
